WITH GeneroMasJuegos AS (
    SELECT g.nombre_genero, COUNT(v.id_videojuego) AS total_juegos
    FROM genero g
    LEFT JOIN videojuego v ON g.id_genero = v.id_genero
    GROUP BY g.nombre_genero
    ORDER BY total_juegos DESC
    LIMIT 1
), VentasAnuales AS (
    SELECT vv.ano_lanzamiento,
           SUM(vt.ventas_na) AS ventas_na,
           SUM(vt.ventas_eu) AS ventas_eu,
           SUM(vt.ventas_jp) AS ventas_jp,
           SUM(vt.otras_ventas) AS otras_ventas,
           SUM(vt.ventas_globales) AS ventas_globales
    FROM venta vt
    INNER JOIN version_videojuego vv ON vt.id_version_videojuego = vv.id_version
    INNER JOIN videojuego v ON vv.id_videojuego_base = v.id_videojuego
    INNER JOIN genero g ON v.id_genero = g.id_genero
    INNER JOIN GeneroMasJuegos gmj ON g.nombre_genero = gmj.nombre_genero
    GROUP BY vv.ano_lanzamiento
)
SELECT va.ano_lanzamiento, 
       va.ventas_na, 
       va.ventas_eu, 
       va.ventas_jp, 
       va.otras_ventas, 
       va.ventas_globales
FROM VentasAnuales va;